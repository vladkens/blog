---
title: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è RIPEMD-160 –∏—Å–ø–æ–ª—å–∑—É—è ARM Neon –∏ –Ω–µ —Ç–æ–ª—å–∫–æ
slug: rmd160-simd
date: 2025-05-08
taxonomies:
  tags: ["simd", "ecloop"]
---

<!-- # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è RIPEMD-160 –∏—Å–ø–æ–ª—å–∑—É—è ARM Neon –∏ –Ω–µ —Ç–æ–ª—å–∫–æ -->

![post cover image](/20250508.png)

–£ –º–µ–Ω—è –µ—Å—Ç—å —Ö–æ–±–±–∏-–ø—Ä–æ–µ–∫—Ç ‚Äî [ecloop](https://github.com/vladkens/ecloop) ‚Äî "–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" Bitcoin-–∫–ª—é—á–µ–π, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –ø–æ–∏—Å–∫–∞ Bitcoin Puzzles, –ø—Ä–æ–≤–µ—Ä–∫–∏ brain wallets –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–≥–æ. –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–Ω—Å—ã –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –Ω—É–ª—é. –≠—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞ –∫–∞–∫ –Ω–∞–±–æ—Ä —Ç—Ä—é–∫–æ–≤ –Ω–∞–¥ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π (secp256k1) –∏ –∫–∞–∫ —Å–ø–æ—Å–æ–± –ø–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, –±–ª–∏–∑–∫–æ–º –∫ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É (–±—ã—Å—Ç—Ä–∞—è 256-–±–∏—Ç–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞), –ø–æ—ç—Ç–æ–º—É —è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é –µ—ë —Ä–∞–∑–≤–∏–≤–∞—Ç—å.

–î–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è Bitcoin-–∞–¥—Ä–µ—Å–∞ –∏–∑ private key –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π:

1. –≤—ã—á–∏—Å–ª–∏—Ç—å —Ç–æ—á–∫—É –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π (Public key) ‚Äî `P = G * PrivKey`
2. –ø–æ—Å—á–∏—Ç–∞—Ç—å SHA256 –æ—Ç PubKey: `(P.y % 2 == 0 ? 0x02 : 0x03) + P.x`
3. –ø–æ—Å—á–∏—Ç–∞—Ç—å RMD160 –æ—Ç –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ SHA256

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–π `hash160`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–µ–º –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ Bitcoin-–∞–¥—Ä–µ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `base58` –∏–ª–∏ `bech32`.

–ö–∞–∫ –±—ã –Ω–∏ –±—ã–ª–∏ –º–µ–¥–ª–µ–Ω–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–æ–π –∫—Ä–∏–≤–æ–π, —Å–∞–º–∞—è –º–µ–¥–ª–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–∞ ‚Äî —ç—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ RMD160. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏, –æ–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—É –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã (SHA256 –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö –∏–º–µ–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ).

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç SIMD: AVX2 –Ω–∞ amd64 –∏ Neon –Ω–∞ arm64. –ü–æ—ç—Ç–æ–º—É —è —Ä–µ—à–∏–ª, —á—Ç–æ –±—ã–ª–æ –±—ã –Ω–µ–ø–ª–æ—Ö–æ —É—Å–∫–æ—Ä–∏—Ç—å RMD160, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–≤ –µ–≥–æ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π. –¢–µ–º –±–æ–ª–µ–µ, —è —Ä–∞–Ω—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∏—Å–∞–ª SIMD-–∫–æ–¥, –∏ –º–Ω–µ –±—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —ç—Ç–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å.

–ú–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä ‚Äî MacBook –Ω–∞ Apple Silicon (M-—á–∏–ø–∞—Ö). –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —è —Ö–æ—Ç–µ–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RMD160 SIMD –Ω–∞ SVE (256 bit / 8 lane), –Ω–æ –æ–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —á–∏–ø—ã Apple –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç SVE ü§¶ (—Å–ª–µ–¥—É–µ—Ç –ø–æ—è—Å–Ω–∏—Ç—å, —á—Ç–æ M2-—á–∏–ø —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç ARMv8.6, –∞ SVE –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ ARMv8.2 —Å –ø–æ–º–µ—Ç–∫–æ–π optional), –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏—à–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Neon (128 bit / 4 lane). –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫, —è –≥–¥–µ-—Ç–æ –æ—à–∏–±—Å—è, –∏ –µ—Å—Ç—å —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞—Ç—å SVE-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ M-—á–∏–ø–∞—Ö ‚Äî –±—É–¥—É —Ä–∞–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º.

## –ß—Ç–æ —Ç–∞–∫–æ–µ RMD160?

RIPEMD-160 (RMD160) ‚Äî —ç—Ç–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è, —Å–æ–∑–¥–∞—é—â–∞—è 160-–±–∏—Ç–Ω—ã–π —Ö–µ—à –∏–∑ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –û–Ω–∞ –±—ã–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º, —Ç–∞–∫–∏–º –∫–∞–∫ MD5 –∏ SHA-1. RMD160 —à–∏—Ä–æ–∫–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ Bitcoin, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –∫–æ—à–µ–ª—å–∫–æ–≤: –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–Ω–∞—á–∞–ª–∞ —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é SHA-256, –∞ –∑–∞—Ç–µ–º ‚Äî RMD160, –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª–∏–Ω—ã.

–ê–ª–≥–æ—Ä–∏—Ç–º RMD160 —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 5 —Ä–∞—É–Ω–¥–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –±–∞–∑–æ–≤—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–¥–≤–∏–≥–∏ (ROTL) –∏ —Å–ª–æ–∂–µ–Ω–∏–µ. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é RMD160 —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –¥–≤—É—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö: –æ—Å–Ω–æ–≤–Ω–æ–π (–ª–µ–≤–∞—è) –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π (–ø—Ä–∞–≤–∞—è). –≠—Ç–∏ –¥–≤–µ –≤–µ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–æ–≤ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ—Å–ª–µ —á–µ–≥–æ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è.

–ï—Å—Ç—å [–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è](https://homes.esat.kuleuven.be/~bosselae/ripemd160/ps/AB-9601/rmd160.h) [C-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://homes.esat.kuleuven.be/~bosselae/ripemd160/ps/AB-9601/rmd160.c) RMD160 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫—É—á–∏ –º–∞–∫—Ä–æ—Å–æ–≤ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Ä–∞—É–Ω–¥–æ–≤, –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ç.–ø., –Ω–æ —Ç–∞–∫–æ–π –∫–æ–¥ —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å, –ø–æ—ç—Ç–æ–º—É –º–Ω–µ –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ [Golang](https://cs.opensource.google/go/x/crypto/+/refs/tags/v0.37.0:ripemd160/ripemd160block.go), –∫–æ—Ç–æ—Ä—É—é —è —Ä–∞–Ω–µ–µ —É–∂–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª –≤ `ecloop`. –î–∞–ª—å–Ω–µ–π—à–µ–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Neon —è –ø–ª–∞–Ω–∏—Ä—É—é –¥–µ–ª–∞—Ç—å –Ω–∞ —ç—Ç–æ–π –æ—Å–Ω–æ–≤–µ.

–ï—Å–ª–∏ –æ—Ç–æ–π—Ç–∏ –Ω–µ–º–Ω–æ–≥–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É ‚Äî SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–µ –≤—ã–≥–ª—è–¥—è—Ç —á–µ–º-—Ç–æ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–º, –Ω–æ —É –Ω–∏—Ö –Ω–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ —Å–∞—Ö–∞—Ä–∞, –ø–æ—ç—Ç–æ–º—É –≤–º–µ—Å—Ç–æ `a + b` –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å —á—Ç–æ-—Ç–æ –≤ –¥—É—Ö–µ vaddq_u32(a, b). –¢–∞–∫–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –µ—Å—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–ª–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ (u/i 8/16/32/64, f16/32/64).

RMD160 (–∫–∞–∫ –∏ –¥—Ä—É–≥–∏–µ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ SIMD, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö –Ω–µ—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏–π. –ü–æ —Å—É—Ç–∏, –∞–ª–≥–æ—Ä–∏—Ç–º –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ ‚Äî —Ç–æ–ª—å–∫–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ SIMD-—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

## –ü—Ä–æ—Å—Ç–∞—è Neon –ø—Ä–æ–≥—Ä–∞–º–º–∞

–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –ø–∏—Å–∞—Ç—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Neon, —Å–ª–µ–¥—É–µ—Ç –Ω–∞—á–∞—Ç—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —É–º–Ω–æ–∂–∏—Ç—å 42 √ó 2. –¢–∞–∫ –∫–∞–∫ SIMD ‚Äî —ç—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –≤–µ—Å—å –≤–µ–∫—Ç–æ—Ä —Å—Ä–∞–∑—É, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –≤–µ–∫—Ç–æ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º. –ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ —ç—Ç–æ–º, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å.

```c
#include <arm_neon.h>
#include <stdint.h>
#include <stdio.h>

void print_check(uint32x4_t *a) {
  uint32_t arr[4];
  vst1q_u32(arr, *a); // store 4x32-bit vector into a regular array
  for (int i = 0; i < 4; i++) {
    printf("%x%c", arr[i], i == 3 ? '\n' : ' ');
  }
}

int main() {
  uint32_t a = 42;
  uint32x4_t b = vdupq_n_u32(42); // load u32 to all 4 lanes (42, 42, 42, 42)
  printf("%x = ", a);
  print_check(&b); // out: 2a = 2a 2a 2a 2a

  a = a * 2;
  b = vmulq_n_u32(b, 2); // multiply each lane by 2
  printf("%x = ", a);
  print_check(&b); // out: 54 = 54 54 54 54

  return 0;
}
```

–í –æ–±—â–µ–º, –∏–¥–µ—è —Ç–æ–≥–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç SIMD-–≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –¥—É–º–∞—é, –ø–æ–Ω—è—Ç–Ω–∞. –î–∞–ª–µ–µ `print_check` –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —á–∞—Å—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞.

## –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ ROTL

–í –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ RMD160 –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è 5 –±–∞–∑–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ ROTL ‚Äî –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ —ç—Ç–æ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. GPT –ø–µ—Ä–µ–ø–∏—Å–∞–ª —ç—Ç–∏ –º–∞–∫—Ä–æ—Å—ã, –∞ —è –ø—Ä–æ–≤–µ—Ä–∏–ª –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:

```c
// original functions
#define OLD_F1(x, y, z) ((x) ^ (y) ^ (z))
#define OLD_F2(x, y, z) (((x) & (y)) | (~(x) & (z)))
#define OLD_F3(x, y, z) (((x) | ~(y)) ^ (z))
#define OLD_F4(x, y, z) (((x) & (z)) | ((y) & ~(z)))
#define OLD_F5(x, y, z) ((x) ^ ((y) | ~(z)))
#define OLD_ROTL(x, n) (((x) << (n)) | ((x) >> (32 - (n))))

// simd functions
#define F1(x, y, z) veorq_u32(veorq_u32(x, y), z)
#define F2(x, y, z) vorrq_u32(vandq_u32(x, y), vandq_u32(vmvnq_u32(x), z))
#define F3(x, y, z) veorq_u32(vorrq_u32(x, vmvnq_u32(y)), z)
#define F4(x, y, z) vorrq_u32(vandq_u32(x, z), vandq_u32(y, vmvnq_u32(z)))
#define F5(x, y, z) veorq_u32(x, vorrq_u32(y, vmvnq_u32(z)))
#define ROTL(x, n) vorrq_u32(vshlq_n_u32(x, n), vshrq_n_u32(x, 32 - (n)))

void print_check(char *l, uint32_t c, uint32x4_t a) {
  printf("%s: %08x = ", l, c);
  uint32_t arr[4];
  vst1q_u32(arr, a); // store 4x32-bit vector into a regular array
  for (int i = 0; i < 4; i++) {
    printf("%08x%c", arr[i], i == 3 ? '\n' : ' ');
    // assert(arr[i] == c);
  }
}

uint32_t a1, b1, c1;
uint32x4_t a2, b2, c2;

a1 = 0x67452301, b1 = 0xefcdab89, c1 = 0x98badcfe;
a2 = vdupq_n_u32(a1), b2 = vdupq_n_u32(b1), c2 = vdupq_n_u32(c1); // loading vectors

// // compare original and simd functions
print_check("F1", OLD_F1(a1, b1, c1), F1(a2, b2, c2));
print_check("F2", OLD_F2(a1, b1, c1), F2(a2, b2, c2));
print_check("F3", OLD_F3(a1, b1, c1), F3(a2, b2, c2));
print_check("F4", OLD_F4(a1, b1, c1), F4(a2, b2, c2));
print_check("F5", OLD_F5(a1, b1, c1), F5(a2, b2, c2));
print_check("RL", OLD_ROTL(a1, 12), ROTL(a2, 12));

// output:
// F1: 10325476 = 10325476 10325476 10325476 10325476
// F2: ffffffff = ffffffff ffffffff ffffffff ffffffff
// F3: efcdab89 = efcdab89 efcdab89 efcdab89 efcdab89
// F4: 67452301 = 67452301 67452301 67452301 67452301
// F5: 88888888 = 88888888 88888888 88888888 88888888
// RL: 52301674 = 52301674 52301674 52301674 52301674
```

## –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º Golang-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

Golang-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 5 –±–æ–ª—å—à–∏—Ö —Ü–∏–∫–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø–æ 16 –ª–µ–≤—ã—Ö –∏ –ø—Ä–∞–≤—ã—Ö —Ä–∞—É–Ω–¥–æ–≤; –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–∏–∫—Å—É—é—Ç—Å—è –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É `_n[i]` –∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ROTL –ø–æ –∏–Ω–¥–µ–∫—Å—É `_r[i]`. –í reference C-implementation –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—É—á–∞ –ø–æ–¥—Ä—è–¥ –∏–¥—É—â–∏—Ö –º–∞–∫—Ä–æ—Å–æ–≤, –∏–∑-–∑–∞ —á–µ–≥–æ, –Ω–∞ –º–æ–π –≤–∑–≥–ª—è–¥, —á–∏—Ç–∞—Ç—å —Ç–∞–∫–æ–µ —Å–ª–æ–∂–Ω–µ–µ.

```c
// Golang implementation
static const u8 _n[80] = { /* ... */ }; // Left DATA indexes
static const u8 _r[80] = { /* ... */ }; // Left ROTL indexes

// round 1
for (; i < 16; ++i) {
  // left branch
  alpha = a1 + F1(b1, c1, d1) + x[_n[i]];
  alpha = rotl32(alpha, _r[i]) + e1;
  beta = rotl32(c1, 10);
  a1 = e1, c1 = b1, e1 = d1, b1 = alpha, d1 = beta;
  // right branch
  // ...
}

// Reference C-implementation
#define F(x, y, z)        ((x) ^ (y) ^ (z))

#define FF(a, b, c, d, e, x, s)        {\
      (a) += F((b), (c), (d)) + (x);\
      (a) = ROL((a), (s)) + (e);\
      (c) = ROL((c), 10);\
   }

// round 1 - left branch
FF(aa, bb, cc, dd, ee, X[ 0], 11);
FF(ee, aa, bb, cc, dd, X[ 1], 14);
// ...
FF(bb, cc, dd, ee, aa, X[14],  9);
FF(aa, bb, cc, dd, ee, X[15],  8);
```

–í –æ–±—â–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫–æ–¥ –Ω–∞–ø—Ä—è–º—É—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Neon-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, —Ç–æ –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π: `vshlq_n_u32` –∏ `vshrq_n_u32` —Ç—Ä–µ–±—É—é—Ç, —á—Ç–æ–±—ã –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ (–≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç) –±—ã–ª–æ –∏–∑–≤–µ—Å—Ç–Ω–æ –Ω–∞ –º–æ–º–µ–Ω—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –ü—Ä–∏–º–µ—Ä –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:

```c
// Golang implementation (original)
#define F1(x, y, z) ((x) ^ (y) ^ (z))
#define rotl32(x, n) (((x) << (n)) | ((x) >> (32 - (n))))
alpha = a1 + F1(b1, c1, d1) + x[_n[i]];
alpha = rotl32(alpha, _r[i]) + e1;

// Golang implementation (SIMD)
#define F1(x, y, z) veorq_u32(veorq_u32(x, y), z)
#define ROTL(x, n) vorrq_u32(vshlq_n_u32(x, n), vshrq_n_u32(x, 32 - (n)))
alpha = vaddq_u32(a1, F1(b1, c1, d1));
alpha = vaddq_u32(alpha, X[_n[i]]);
alpha = vaddq_u32(ROTL(alpha, _r[i]), e1);
// err: argument to '__builtin_neon_vshlq_n_v' must be a constant integer
// err: argument to '__builtin_neon_vshrq_n_v' must be a constant integer
```

–¢–∞–∫ —á—Ç–æ –ø—Ä–∏–¥—ë—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é –Ω–∞ –º–∞–∫—Ä–æ—Å–∞—Ö, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–º –∏–Ω–¥–µ–∫—Å—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é (–ø–æ—Å–ª–µ–¥–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç –≤ –º–∞–∫—Ä–æ—Å–µ `FF`) –∏ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –∫ –ª—É—á—à–µ–º—É (–ø–æ–∑–∂–µ —É–≤–∏–¥–∏–º –ø–æ—á–µ–º—É).

## –û–±–æ–±—â—ë–Ω–Ω—ã–π –º–∞–∫—Ä–æ—Å —Ä–∞—É–Ω–¥–∞

–ï—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ä–∞—É–Ω–¥—ã RMD160, —Ç–æ —Ç–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–æ –º–µ–Ω—è—é—Ç—Å—è: –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –∏–Ω–¥–µ–∫—Å –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–≤–æ—Ä–æ—Ç. –í –æ–±—â–µ–º, –º–∞–∫—Ä–æ—Å —Ä–∞—É–Ω–¥–∞ –±—ã–ª –≤—ã—à–µ (—è –≤–∑—è–ª –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–æ–π –∫–æ–¥ —Å GitHub). –ú–æ—è —Ü–µ–ª—å ‚Äî –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å —Ä–∞—É–Ω–¥–∞ –Ω–∞ SIMD.

–í —Ä–∞—É–Ω–¥–µ –º—ã —Å–∫–ª–∞–¥—ã–≤–∞–µ–º 4 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–µ–ª–∞–µ–º ROTL + –µ—â—ë –æ–¥–Ω–æ —Å–ª–æ–∂–µ–Ω–∏–µ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π ROTL –¥–ª—è –¥—Ä—É–≥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –¢–∞–∫ –∫–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ–∂–µ–Ω–∏—è "+" –Ω–µ—Ç –≤ SIMD, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

–Ø –¥–æ–±–∞–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞–∫—Ä–æ—Å–æ–≤ –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –∏ –æ–ø–∏—Å–∞–ª —Å–∞–º —Ä–∞—É–Ω–¥:

```c
#define ADD2(a, b) vaddq_u32(a, b)
#define ADD3(a, b, c) vaddq_u32(vaddq_u32(a, b), c)
#define ADD4(a, b, c, d) vaddq_u32(vaddq_u32(vaddq_u32(a, b), c), d)

#define RN(a, b, c, d, e, f, x, k, r) \
  u = ADD4(a, f, x, vdupq_n_u32(k));  \
  a = ADD2(ROTL(u, r), e);            \
  c = ROTL(c, 10);
```

–í –º–∞–∫—Ä–æ—Å–µ `a`, `b`, `c`, `d`, `e` ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, `f` ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, x ‚Äî —ç—Ç–æ uint32 –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏–Ω–¥–µ–∫—Å—É –¥–ª—è —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏, `k` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –∏ `r` ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ –¥–ª—è ROTL.

`vdupq_n_u32(k)` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –≤ –≤–µ–∫—Ç–æ—Ä (–æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–æ –≤—Å–µ 4 lanes). –†–∞–Ω–µ–µ –º—ã –ø–∏—Å–∞–ª–∏ –∫–æ–¥, —á—Ç–æ–±—ã —É–º–Ω–æ–∂–∏—Ç—å –≤–µ–∫—Ç–æ—Ä –Ω–∞ —á–∏—Å–ª–æ; –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [`vmulq_n_u32`](https://developer.arm.com/architectures/instruction-sets/intrinsics/vmulq_n_u32). –õ–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–∏—Å–ª–∞ –∫ –≤–µ–∫—Ç–æ—Ä—É –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å `vaddq_n_u32`, –Ω–æ –µ—ë [–Ω–µ—Ç](https://developer.arm.com/architectures/instruction-sets/intrinsics/vaddq_n_u32). –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ —Å—Ç–∏–ª–µ `vaddq_u32(vec1, vdupq_n_u32(2))` (–µ—Å–ª–∏ –∫—Ç–æ –∑–Ω–∞–µ—Ç, –ø–æ—á–µ–º—É —Ç–∞–∫ ‚Äî –ø–∏—à–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏).

–î–∞–ª–µ–µ, –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ–≥–æ –º–∞–∫—Ä–æ—Å–∞, –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–µ–≤—ã–µ –∏ –ø—Ä–∞–≤—ã–µ —Ä–∞—É–Ω–¥—ã. –¢—É—Ç –∫–æ–¥ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –º–∞–∫—Ä–æ—Å–∞—Ö (—Ä–∞–∑–≤–µ —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞—É–Ω–¥–æ–≤ —è —Å–¥–µ–ª–∞–ª –∫–∞–∫ `Li`/`Ri`).

```c
#define L1(a, b, c, d, e, x, r) RN(a, b, c, d, e, F1(b, c, d), x, 0, r)
#define L2(a, b, c, d, e, x, r) RN(a, b, c, d, e, F2(b, c, d), x, 0x5A827999ul, r)
#define L3(a, b, c, d, e, x, r) RN(a, b, c, d, e, F3(b, c, d), x, 0x6ED9EBA1ul, r)
#define L4(a, b, c, d, e, x, r) RN(a, b, c, d, e, F4(b, c, d), x, 0x8F1BBCDCul, r)
#define L5(a, b, c, d, e, x, r) RN(a, b, c, d, e, F5(b, c, d), x, 0xA953FD4Eul, r)
#define R1(a, b, c, d, e, x, r) RN(a, b, c, d, e, F5(b, c, d), x, 0x50A28BE6ul, r)
#define R2(a, b, c, d, e, x, r) RN(a, b, c, d, e, F4(b, c, d), x, 0x5C4DD124ul, r)
#define R3(a, b, c, d, e, x, r) RN(a, b, c, d, e, F3(b, c, d), x, 0x6D703EF3ul, r)
#define R4(a, b, c, d, e, x, r) RN(a, b, c, d, e, F2(b, c, d), x, 0x7A6D76E9ul, r)
#define R5(a, b, c, d, e, x, r) RN(a, b, c, d, e, F1(b, c, d), x, 0, r)
```

–¢–µ–ø–µ—Ä—å, –∏—Å–ø–æ–ª—å–∑—É—è —ç—Ç–∏ –º–∞–∫—Ä–æ—Å—ã, –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞, —Å—Ä–∞–≤–Ω–∏—Ç—å –µ—ë —Å —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π. –ï—Å–ª–∏ –≤—Å—ë –æ–∫, —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å —Ä–∞—É–Ω–¥ —Ü–µ–ª–∏–∫–æ–º, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ, –∞ –∑–∞—Ç–µ–º –∏ –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ä–∞—É–Ω–¥—ã. –†–µ–∑—É–ª—å—Ç–∞—Ç —è —Å—Ä–∞–≤–Ω–∏–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏–µ–π print_check, –∫–æ—Ç–æ—Ä—É—é –¥–µ–ª–∞–ª —Ä–∞–Ω–µ–µ.

–ü–µ—Ä–≤—ã–π –ª–µ–≤—ã–π —Ä–∞—É–Ω–¥, –ø–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è:

```c
#define K1 0x67452301
#define K2 0xEFCDAB89
#define K3 0x98BADCFE
#define K4 0x10325476
#define K5 0xC3D2E1F0

void rmd160_block(uint32x4_t *s, const uint32_t x[4][16]) {
  // a1-e1 left rounds state, a2-e2 right rounds state, u - temp varible used in RD macro
  uint32x4_t a1, b1, c1, d1, e1, a2, b2, c2, d2, e2, u;
  // Load initial constants
  a1 = a2 = vdupq_n_u32(K1);
  b1 = b2 = vdupq_n_u32(K2);
  c1 = c2 = vdupq_n_u32(K3);
  d1 = d2 = vdupq_n_u32(K4);
  e1 = e2 = vdupq_n_u32(K5);

  uint32x4_t w[16]; // Load data to vector
  for (int i = 0; i < 16; i++) {
    // Load 4x32-bit integers from x[0][i], x[1][i], x[2][i], x[3][i]
    // w[i] = vsetq_lane_u32(x[0][i], w[i], 0);
    // w[i] = vsetq_lane_u32(x[1][i], w[i], 1);
    // w[i] = vsetq_lane_u32(x[2][i], w[i], 2);
    // w[i] = vsetq_lane_u32(x[3][i], w[i], 3);
    w[i] = vld1q_u32(((uint32_t[4]){x[0][i], x[1][i], x[2][i], x[3][i]})); // A bit faster
  }

  L1(a1, b1, c1, d1, e1, w[0], 11);
  print_check("a1", 0, a1);
  print_check("b1", 0, b1);
  print_check("c1", 0, c1);
  print_check("d1", 0, d1);
  print_check("e1", 0, e1);
}

uint32x4_t s[5] = {0}; // initial state
s[0] = vdupq_n_u32(K1);
s[1] = vdupq_n_u32(K2);
s[2] = vdupq_n_u32(K3);
s[3] = vdupq_n_u32(K4);
s[4] = vdupq_n_u32(K5);

uint32_t x[4][16] = {0}; // data block, filled with zeros
rmd160_block((uint32x4_t *)s, x);
```

–°–ª–µ–¥—É–µ—Ç –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –æ–±—ã—á–Ω–æ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç –Ω–∞ –Ω—É–ª–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–±–æ—Ç—ã). –î–∞–Ω–Ω—ã–µ –≤ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ –±–ª–æ–∫–∞–º. –ë–ª–æ–∫ –≤ RMD160 ‚Äî —ç—Ç–æ 32√ó16 = 512 –±–∏—Ç. `rmd160_block` –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å —Ç–µ–º –∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (–æ–Ω –º–µ–Ω—è–µ—Ç—Å—è) –∏ –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å —Ö–µ—à —Å–æ–æ–±—â–µ–Ω–∏—è, –±–æ–ª—å—à–µ–≥–æ —á–µ–º –æ–¥–∏–Ω —Ä–∞—É–Ω–¥. –í –º–æ–µ–π –∑–∞–¥–∞—á–µ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤) –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –æ–¥–∏–Ω –±–ª–æ–∫. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ `vs` —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```
// a1: 1602f864 1602f864 1602f864 1602f864 vs c3d2e1f0
// a1: efcdab89 efcdab89 efcdab89 efcdab89 vs 1602f864
// a1: eb73fa62 eb73fa62 eb73fa62 eb73fa62 vs efcdab89
// a1: 10325476 10325476 10325476 10325476 vs eb73fa62
// a1: c3d2e1f0 c3d2e1f0 c3d2e1f0 c3d2e1f0 vs 10325476
```

–í –æ–±—â–µ–º, —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è ¬± –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏, –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ —Å–º–µ—â–µ–Ω–∏–µ. –≠—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö 5, –∏ –∫ –∫–æ–Ω—Ü—É —Å–º–µ—â–µ–Ω–∏—è –æ–Ω–∏ –≤—ã—Ä–∞–≤–Ω—è—é—Ç—Å—è. –ü—Ä–æ—Å—Ç–æ —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö.

–í—Å–µ —Ä–∞—É–Ω–¥—ã —è –ø–∏—Å–∞—Ç—å –Ω–µ –±—É–¥—É, –∏—Ö —Ç–∞–º –ø–æ 80 —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã (–≤—Å–µ–≥–æ 160) ‚Äî –≤—ã–π–¥–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ. –õ–µ–≤—ã–µ –∏ –ø—Ä–∞–≤—ã–µ —Ä–∞—É–Ω–¥—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, –∏ –≤—ã—á–∏—Å–ª—è—Ç—å –∏—Ö –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ: –ª–∏–±–æ —Å–Ω–∞—á–∞–ª–∞ –≤—Å–µ –ª–µ–≤—ã–µ / –≤—Å–µ –ø—Ä–∞–≤—ã–µ, –ª–∏–±–æ —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –ª–µ–≤—ã–µ / –ø—Ä–∞–≤—ã–µ, –ª–∏–±–æ –≤–æ–æ–±—â–µ —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ä–∞—É–Ω–¥–∞. –ù–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–æ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç.

## –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è RMD160

–í –∫–æ–Ω—Ü–µ –±–ª–æ–∫–∞ RMD160 –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º ‚Äî —ç—Ç–æ —Ç–æ–∂–µ —Ç—Ä–∏ —Å–ª–æ–∂–µ–Ω–∏—è —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤.

```c
void rmd160_block(uint32x4_t *s, const uint32_t x[4][16]) {
  // ... 160 rounds

  uint32x4_t t = s[0];
  s[0] = ADD3(s[1], c1, d2);
  s[1] = ADD3(s[2], d1, e2);
  s[2] = ADD3(s[3], e1, a2);
  s[3] = ADD3(s[4], a1, b2);
  s[4] = ADD3(t, b1, c2);
}
```

–§–∏–Ω–∞–ª—å–Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å endianness —É –∑–Ω–∞—á–µ–Ω–∏–π (RMD160 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ —Ç–æ—Ç endianness) –∏ –≤—ã–≥—Ä—É–∑–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤–µ–∫—Ç–æ—Ä–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –º–∞—Å—Å–∏–≤.

```c
// ... init & rmd160_block

for (int i = 0; i < 5; ++i) {
  // swap32 for uint32x4_t (can it be shorter?)
  s[i] = vreinterpretq_u32_u8(vrev32q_u8(vreinterpretq_u8_u32(s[i])));
}

uint32_t r[4][5] = {0}; // result stored as 4x5 uint32_t
for (int i = 0; i < 5; i++) { // load it from uint32x4_t
  r[0][i] = vgetq_lane_u32(s[i], 0);
  r[1][i] = vgetq_lane_u32(s[i], 1);
  r[2][i] = vgetq_lane_u32(s[i], 2);
  r[3][i] = vgetq_lane_u32(s[i], 3);
}
```

–ù–∞ —ç—Ç–æ–º, –≤ –æ–±—â–µ–º, –∏ –≤—Å—ë ‚Äî `r` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ, –≥–¥–µ –Ω—É–∂–Ω–æ (`r[0]`, `r[1]`, `r[2]`, `r[3]` ‚Äî —ç—Ç–æ –ø–æ—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ö–µ—à–∏, 4 —Å—Ä–∞–∑—É).

–ü–æ–¥–≤–æ–¥—è –∏—Ç–æ–≥ –ø–æ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏, –ø–æ–ª–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ RMD160 –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–µ–π—Ç –¥–ª–∏–Ω–æ–π 160 –±–∏—Ç √ó 4 lanes (`uint32x4_t s[5]`).
2. –†–∞–∑–±–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–∞–Ω–Ω—ã–µ) –Ω–∞ –±–ª–æ–∫–∏ –ø–æ 512 –±–∏—Ç √ó 4 lanes (`uint32_t x[4][16]`).
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å RMD160 —Ä–∞—É–Ω–¥—ã, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–∫–æ–Ω—á–∞—Ç—Å—è (`rmd160_block` —Å–∞–º —Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–µ–∫—Ç–æ—Ä).
4. –ò–∑–º–µ–Ω–∏—Ç—å endianness –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Å—Ç–µ–π—Ç–µ.
5. –í—ã–≥—Ä—É–∑–∏—Ç—å –≤–µ–∫—Ç–æ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–µ–π—Ç–∞ –≤ –º–∞—Å—Å–∏–≤ —Ö–µ—à–µ–π (`int32_t r[4][5]`).

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å RMD160 SIMD

–¢–µ–ø–µ—Ä—å –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞–º–µ—Ä–∏—Ç—å —Ç–æ, –∑–∞—á–µ–º —ç—Ç–æ –∑–∞—Ç–µ–≤–∞–ª–æ—Å—å ‚Äî —Å—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏ SIMD-–∫–æ–¥–∞. –î–ª—è —ç—Ç–æ–≥–æ —è —Å–¥–µ–ª–∞–ª –Ω–µ–±–æ–ª—å—à–æ–π benchmark:

```c
size_t tsnow() {
  struct timespec ts;
  clock_gettime(CLOCK_REALTIME, &ts);
  return ts.tv_sec * 1000 + ts.tv_nsec / 1e6;
}

void rmd160_simd() {
  uint32_t r[4][5] = {0};
  uint32_t x[4][16] = {0};

  size_t stime = tsnow();
  size_t iters = 1000 * 1000 * 32;
  for (size_t i = 0; i < iters; ++i) rmd160_4w(r, x);
  double dt = (tsnow() - stime) / 1000.0;
  double ir = iters / dt / 1000000;
  double hr = ir * 4; // 4 hash per iter
  printf("%.2fM it/s ~ %.2fM h/s ~ %.2fs\n", ir, hr, dt);

  printf("s[0]: %08x\n", r[0][0]);
  printf("s[1]: %08x\n", r[0][1]);
  printf("s[2]: %08x\n", r[0][2]);
  printf("s[3]: %08x\n", r[0][3]);
  printf("s[4]: %08x\n", r[0][4]);
}

void rmd160_naive() {
  uint32_t s[5] = {0};
  uint32_t x[16] = {0};

  size_t stime = tsnow();
  size_t iters = 1000 * 1000 * 32;
  for (size_t i = 0; i < iters; ++i) rmd160_1w(s, x);
  double dt = (tsnow() - stime) / 1000.0;
  double ir = iters / dt / 1000000;
  double hr = ir * 1; // 1 hash per iter
  printf("%.2fM it/s ~ %.2fM h/s ~ %.2fs\n", ir, hr, dt);

  printf("s[0]: %08x\n", s[0]);
  printf("s[1]: %08x\n", s[1]);
  printf("s[2]: %08x\n", s[2]);
  printf("s[3]: %08x\n", s[3]);
  printf("s[4]: %08x\n", s[4]);
}
```

–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª –æ–±–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å `-O3` –∏ –∑–∞–ø—É—Å—Ç–∏–ª (–Ω–∞ –±–∞–∑–æ–≤–æ–º Apple M2):

```sh
‚ùØ clang -O3 -march=native ./lib/rmd160.c && ./a.out # original
5.50M it/s ~ 5.50M h/s ~ 5.81s

‚ùØ clang -O3 -march=native ./lib/rmd160s.c && ./a.out # neon
2.14M it/s ~ 8.55M h/s ~ 14.98s
```

–í—ã—à–ª–æ, —á—Ç–æ –≤–µ—Ä—Å–∏—è –Ω–∞ Neon (128 –±–∏—Ç / 4 lanes) —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 55% –±—ã—Å—Ç—Ä–µ–µ. –ß—Ç–æ, –∫–æ–Ω–µ—á–Ω–æ, –∫—Ä—É—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –ø–µ—á–∞–ª—å–Ω–æ, —á—Ç–æ –Ω–∞ M-chips –Ω–µ—Ç SVE –¥–ª—è 256/512 –±–∏—Ç (8/16 lanes) ‚Äî —Ç–∞–∫ –±—ã–ª–æ –±—ã –µ—â—ë –ª—É—á—à–µ!

## One more thing

–ü–æ–∫–∞ —è –∑–∞–ø–∏—Å—ã–≤–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã –≤—ã—à–µ, –º–Ω–µ —Å—Ç–∞–ª–æ _–ª—é–±–æ–ø—ã—Ç–Ω–æ_, —á—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –ø–æ–∏–≥—Ä–∞—Ç—å—Å—è —Å –ø–æ—Ä—è–¥–∫–æ–º —Ä–∞—É–Ω–¥–æ–≤ –≤ RMD160. –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—É–Ω–¥–æ–≤ –±—ã–ª —Ç–∞–∫–æ–π: —Å–Ω–∞—á–∞–ª–∞ –≤—Å–µ –ª–µ–≤—ã–µ —Ä–∞—É–Ω–¥—ã, –∑–∞—Ç–µ–º –≤—Å–µ –ø—Ä–∞–≤—ã–µ. –ú–Ω–µ –∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —ç—Ç–æ —Ö–æ—Ä–æ—à–æ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ, –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥, –Ω—É–∂–Ω–æ –º–µ–Ω—å—à–µ "–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞".

–Ø –ø–æ–º–µ–Ω—è–ª –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—É–Ω–¥–æ–≤ –Ω–∞ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ –ª–µ–≤—ã—Ö –∏ –ø—Ä–∞–≤—ã—Ö (`L1 / R1, L2 / R2`), –∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤–æ–∑—Ä–æ—Å–ª–∞. –Ø –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–¥—É–º–∞–ª, —á—Ç–æ –æ—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ `print_check` (–≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ—Å—Ç–æ–≤) –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ.

–Ø —Ä–µ—à–∏–ª –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏–∏ (`L1_1 R1_1 L1_2 R1_2` –∏ —Ç.–¥.). –ß–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä—è, –ø–µ—Ä–µ—Å—Ç–∞–≤–ª—è—Ç—å 160 —Å—Ç—Ä–æ—á–µ–∫ ‚Äî –Ω–µ —Å–∞–º–æ–µ –≤–µ—Å–µ–ª–æ–µ –∑–∞–Ω—è—Ç–∏–µ, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∏–≤–∏–ª –º–µ–Ω—è –µ—â—ë –±–æ–ª—å—à–µ.

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—â–µ–Ω–∏–π (—Ç—Ä–∏ —Ç–µ—Å—Ç–∞ —Å–∞–º–æ–π RMD160 —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –ª–æ–≥–∏–∫–∏ `ecloop`):

```sh
# L1_1 L2_2 .. L5_16 R1_1 R2_2 .. R5_16 (+56%)
2.25M it/s ~ 9.02M h/s ~ 14.19s
2.23M it/s ~ 8.93M h/s ~ 14.33s
2.23M it/s ~ 8.94M h/s ~ 14.32s
ecloop (addr33 x 8 core) ~ 19.53M it/s (+22%)

# L1_1-L1_16 R1_1-R1_16 L2_1-L2_16 .. (+165%)
3.70M it/s ~ 14.80M h/s ~ 8.65s
3.85M it/s ~ 15.42M h/s ~ 8.30s
3.87M it/s ~ 15.46M h/s ~ 8.28s
ecloop (addr33 x 8 core) ~ 22.46M it/s (+40%)

# L1_1 R1_1 L1_2 R1_2 .. L5_16 R5_16 (+175%)
3.96M it/s ~ 15.82M h/s ~ 8.09s
3.94M it/s ~ 15.78M h/s ~ 8.11s
3.94M it/s ~ 15.76M h/s ~ 8.12s
ecloop (addr33 x 8 core) ~ 24.83M it/s (+55%)
```

–î–ª—è –º–µ–Ω—è –∑–∞–≥–∞–¥–∫–∞, –ø–æ—á–µ–º—É —ç—Ç–æ —Ç–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –µ—â—ë –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞? –ö—Ç–æ –∑–Ω–∞–µ—Ç ‚Äî –ø–∏—à–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ AVX2 (AMD64)

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —É –º–µ–Ω—è –Ω–µ –±—ã–ª–æ —ç—Ç–æ–≥–æ –≤ –ø–ª–∞–Ω–∞—Ö, –Ω–æ –∞–ª–≥–æ—Ä–∏—Ç–º RMD160 –Ω–∞ –º–∞–∫—Ä–æ—Å–∞—Ö –≤—ã—à–µ–ª –¥–æ–≤–æ–ª—å–Ω–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º, –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ AVX2 –≤—ã–≥–ª—è–¥–µ–ª–æ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º. –û—Å–Ω–æ–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ AVX2 –æ—Ç Neon (–∫—Ä–æ–º–µ –¥—Ä—É–≥–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π) ‚Äî —ç—Ç–æ —Ä–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞: 256 –±–∏—Ç –ø—Ä–æ—Ç–∏–≤ 128 –±–∏—Ç. –¢–æ –µ—Å—Ç—å, –º–æ–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å 8 —Ö–µ—à–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–ø—Ä–æ—Ç–∏–≤ 4-—Ö —É Neon).

–î–∞–ª—å–Ω–µ–π—à–µ–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç–∞–∫–∏—Ö —ç—Ç–∞–ø–æ–≤:

1. –≤—ã–Ω–µ—Å—Ç–∏ –≤–µ—Å—å Neon-—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π –∫–æ–¥ –≤ –º–∞–∫—Ä–æ—Å—ã
2. –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ –º–∞–∫—Ä–æ—Å—ã –ø–æ–¥ AVX2
3. –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –Ω–∞ amd64

–°–µ–π—á–∞—Å –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–¥–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–∞–∫–∏–µ Neon-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: —Ç–∏–ø –≤–µ–∫—Ç–æ—Ä–∞ (uint32x4_t), –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ `vdupq_n_u32`, endian-swap –∏ load / dump –¥–∞–Ω–Ω—ã—Ö –≤ –≤–µ–∫—Ç–æ—Ä.

–ü–µ—Ä–µ–Ω–æ—à—É —ç—Ç–∏ –≤–µ—â–∏ –≤ –º–∞–∫—Ä–æ—Å—ã (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —è –¥–æ–±–∞–≤–∏–ª –ø—Ä–µ—Ñ–∏–∫—Å `RMD_`, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏):

```c
#define RMD_LEN 4                    // vector length
#define RMD_VEC uint32x4_t           // vector type
#define RMD_LD_NUM(x) vdupq_n_u32(x) // load same number into all lanes

#define RMD_SWAP(x) vreinterpretq_u32_u8(vrev32q_u8(vreinterpretq_u8_u32(x)))
#define RMD_LOAD(x, i) vld1q_u32(((uint32_t[4]){x[0][i], x[1][i], x[2][i], x[3][i]}))
#define RMD_DUMP(r, s, i)                                                                        \
  do {                                                                                           \
    r[0][i] = vgetq_lane_u32(s[i], 0);                                                           \
    r[1][i] = vgetq_lane_u32(s[i], 1);                                                           \
    r[2][i] = vgetq_lane_u32(s[i], 2);                                                           \
    r[3][i] = vgetq_lane_u32(s[i], 3);                                                           \
  } while (0);
```

–ò –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –Ω–∞ —á—Ç–æ-—Ç–æ —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞:

```c
void rmd160_block(RMD_VEC *s, const uint32_t x[RMD_LEN][16]) {
  RMD_VEC a1, b1, c1, d1, e1, a2, b2, c2, d2, e2, u;
  a1 = a2 = RMD_LD_NUM(RMD_K1);
  b1 = b2 = RMD_LD_NUM(RMD_K2);
  c1 = c2 = RMD_LD_NUM(RMD_K3);
  d1 = d2 = RMD_LD_NUM(RMD_K4);
  e1 = e2 = RMD_LD_NUM(RMD_K5);

  RMD_VEC w[16];
  for (int i = 0; i < 16; i++) w[i] = RMD_LOAD(x, i);
  // ... rounds and iterations
}

// new function to process full single block
void rmd160_batch(uint32_t r[RMD_LEN][5], const uint32_t x[RMD_LEN][16]) {
  RMD_VEC s[5] = {0}; // load initial state
  s[0] = RMD_LD_NUM(RMD_K1);
  s[1] = RMD_LD_NUM(RMD_K2);
  s[2] = RMD_LD_NUM(RMD_K3);
  s[3] = RMD_LD_NUM(RMD_K4);
  s[4] = RMD_LD_NUM(RMD_K5);

  rmd160_block((RMD_VEC *)s, x);                     // round
  for (int i = 0; i < 5; ++i) s[i] = RMD_SWAP(s[i]); // change endian
  for (int i = 0; i < 5; ++i) RMD_DUMP(r, s, i);     // dump data to array
}
```

–í—ã—à–ª–æ, –∫–æ–Ω–µ—á–Ω–æ, —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–≥–∏—á–µ—Å–∫–∏, –Ω–æ —Å–∞–º–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∞–ª—å–Ω–æ –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ. –¢–µ–ø–µ—Ä—å —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã –¥–ª—è AVX2. –¢–∞–∫–∂–µ —è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–µ—Ä–Ω—É–ª —Å–µ—Ä–∏–∏ –º–∞–∫—Ä–æ—Å–æ–≤, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤ `#ifdef`. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ —Å—É—Ç–∏, —É –º–µ–Ω—è –µ—Å—Ç—å –æ–¥–∏–Ω –∫–æ–¥ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ RMD160, –∏ –Ω—É–∂–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –Ω–∞ –∫–∞–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∞.

```c
#if defined(__aarch64__) && defined(__ARM_NEON)
  #include <arm_neon.h>

  #define RMD_LEN 4                    // vector length
  #define RMD_VEC uint32x4_t           // vector type
  // ... move all current Neon related macros here
#elif defined(__x86_64__) && defined(__AVX2__)
  #include <immintrin.h>

  #define RMD_LEN 8
  #define RMD_VEC __m256i
  #define RMD_LD_NUM(x) _mm256_set1_epi32(x)

  #define RMD_SWAP(x)                                                                              \
    _mm256_shuffle_epi8((x), _mm256_setr_epi8(3, 2, 1, 0, 7, 6, 5, 4, 11, 10, 9, 8, 15, 14, 13,    \
                                              12, 19, 18, 17, 16, 23, 22, 21, 20, 27, 26, 25, 24,  \
                                              31, 30, 29, 28))

  #define RMD_LOAD(x, i)                                                                           \
    _mm256_set_epi32(x[0][i], x[1][i], x[2][i], x[3][i], x[4][i], x[5][i], x[6][i], x[7][i])

  #define RMD_DUMP(r, s, i)                                                                        \
    do {                                                                                           \
      r[0][i] = _mm256_extract_epi32(s[i], 0);                                                     \
      r[1][i] = _mm256_extract_epi32(s[i], 1);                                                     \
      r[2][i] = _mm256_extract_epi32(s[i], 2);                                                     \
      r[3][i] = _mm256_extract_epi32(s[i], 3);                                                     \
      r[4][i] = _mm256_extract_epi32(s[i], 4);                                                     \
      r[5][i] = _mm256_extract_epi32(s[i], 5);                                                     \
      r[6][i] = _mm256_extract_epi32(s[i], 6);                                                     \
      r[7][i] = _mm256_extract_epi32(s[i], 7);                                                     \
    } while (0);

  #define _mm256_not_si256(x) _mm256_xor_si256((x), _mm256_set1_epi32(0xffffffff))
  #define RMD_F1(x, y, z) _mm256_xor_si256(x, _mm256_xor_si256(y, z))
  #define RMD_F2(x, y, z) _mm256_or_si256(_mm256_and_si256(x, y), _mm256_andnot_si256(x, z))
  #define RMD_F3(x, y, z) _mm256_xor_si256(_mm256_or_si256(x, _mm256_not_si256(y)), z)
  #define RMD_F4(x, y, z) _mm256_or_si256(_mm256_and_si256(x, z), _mm256_andnot_si256(z, y))
  #define RMD_F5(x, y, z) _mm256_xor_si256(x, _mm256_or_si256(y, _mm256_not_si256(z)))

  #define RMD_ROTL(x, n) _mm256_or_si256(_mm256_slli_epi32(x, n), _mm256_srli_epi32(x, 32 - (n)))
  #define RMD_ADD2(a, b) _mm256_add_epi32(a, b)
  #define RMD_ADD3(a, b, c) _mm256_add_epi32(_mm256_add_epi32(a, b), c)
  #define RMD_ADD4(a, b, c, d) _mm256_add_epi32(_mm256_add_epi32(a, b), _mm256_add_epi32(c, d))
#else
  #error "Unsupported arch for RIPEMD-160 (AVX2 or NEON required)"
#endif
```

–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è —Å–ª–µ–¥—É—é—â–∏–µ:

- –¥—Ä—É–≥–æ–π –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª
- –¥—Ä—É–≥–æ–π —Ç–∏–ø –≤–µ–∫—Ç–æ—Ä–∞ (8 lanes –≤–º–µ—Å—Ç–æ 4 —É Neon) –∏ –Ω–∞–∑–≤–∞–Ω–∏—è intrinsics
- —É AVX2 –Ω–µ—Ç Bitwise NOT, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏—à–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∫ `_mm256_not_si256`.
- –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è endian-swap, –Ω–æ –µ—Å—Ç—å –±–æ–ª–µ–µ –æ–±–æ–±—â—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å—Ç–∞–≤–ª—è—Ç—å –±–∏—Ç—ã –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ ‚Äî `_mm256_shuffle_epi8` (–ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –≥–¥–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç—å –±–∏—Ç—ã, –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –∫–∞–∫ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç—å).
- `_mm256_set_epi32` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–µ–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã–µ lanes, –≤ Neon –ø—Ä–∏—à–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ (–≤–∞—Ä–∏–∞–Ω—Ç —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∫–∞–∂–¥–æ–π lane –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ (`vsetq_lane_u32`) –æ–∫–∞–∑–∞–ª—Å—è –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω—ã–º).

–° –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ–º –º–∞–∫—Ä–æ—Å–æ–≤ –ø–æ—á—Ç–∏ —Å–ø—Ä–∞–≤–∏–ª—Å—è GPT, —è –ª–∏—à—å –≤ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ –ø—Ä–æ–≤–µ—Ä–∏–ª –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å AVX2 –≤–µ—Ä—Å–∏–∏

–£ –º–µ–Ω—è –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π Fanless PC —Å Linux –Ω–∞ Intel N100, –∫–æ—Ç–æ—Ä—ã–π —è –∏—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ù–∞ –Ω–µ–º —è –∑–∞–ø—É—Å—Ç–∏–ª –±–µ–Ω—á–º–∞—Ä–∫, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ, –∏ –ø–æ–ª—É—á–∏–ª —Ç–∞–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

```sh
‚ùØ clang -O3 -march=native ./lib/rmd160.c && ./a.out # original (on Intel N100)
4.26M it/s ~ 4.26M h/s ~ 7.51s

‚ùØ clang -O3 -march=native ./lib/rmd160s.c && ./a.out # avx2 (on Intel N100)
2.25M it/s ~ 17.96M h/s ~ 14.25s
```

8 lanes AVX2 –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—É–Ω–¥–æ–≤ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ (–∏—Ç–µ—Ä–∞—Ü–∏–∏ "–∑–µ–±—Ä–æ–π") –¥–∞—é—Ç –ø—Ä–∏—Ä–æ—Å—Ç 320% –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ö–µ—à–µ–π –≤ —Å–µ–∫—É–Ω–¥—É –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º. –ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, AVX2 –Ω–∞ Intel N100 —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 20% –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º Neon –Ω–∞ Apple M2 (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–∑-–∑–∞ —Ä–∞–∑–º–µ—Ä–∞ –≤–µ–∫—Ç–æ—Ä–∞). –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ —Ü–µ–ª–æ–º —Å–æ—Å—Ç–∞–≤–∏–ª–æ: `5.45M it/s vs 7.73M it/s (+42%)`.

## Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ / VMs

–í `#ifdef` –≤—ã—à–µ —è –æ—Å—Ç–∞–≤–∏–ª —Å–µ–∫—Ü–∏—é `#else` —Å `#error`, —á—Ç–æ–±—ã –∫–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –Ω–∞ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö. –í –æ–±—â–µ–º, —ç—Ç–æ –Ω–µ —Å–æ–≤—Å–µ–º —Ö–æ—Ä–æ—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ, –∏ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã, —á—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –≤–µ–∑–¥–µ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º —ç—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö). –¢–∞–∫ –∫–∞–∫ –≤–µ—Å—å –∞–ª–≥–æ—Ä–∏—Ç–º —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ –º–∞–∫—Ä–æ—Å–∞—Ö, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ —Å–æ—Å—Ç–∞–≤–∏—Ç —Ç—Ä—É–¥–∞. –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é –≤—Å–µ –º–∞–∫—Ä–æ—Å—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞ 1 –∏ `uint32_t` –≤ –∫–∞—á–µ—Å—Ç–≤–µ "–≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ" —Ç–∏–ø–∞. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –µ–¥–∏–Ω–∏—á–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º, —á—Ç–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ C –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `uint32_t`.

```c
#else
  #warning "Fallback RIPEMD-160 implementation used. AVX2 or NEON required for SIMD"

  #define RMD_LEN 1
  #define RMD_VEC uint32_t
  #define RMD_LD_NUM(x) x

  #define RMD_SWAP(x) __builtin_bswap32(x)
  #define RMD_LOAD(x, i) x[0][i]
  #define RMD_DUMP(r, s, i) r[0][i] = s[i]

  #define RMD_F1(x, y, z) ((x) ^ (y) ^ (z))
  #define RMD_F2(x, y, z) (((x) & (y)) | (~(x) & (z)))
  #define RMD_F3(x, y, z) (((x) | ~(y)) ^ (z))
  #define RMD_F4(x, y, z) (((x) & (z)) | ((y) & ~(z)))
  #define RMD_F5(x, y, z) ((x) ^ ((y) | ~(z)))

  #define RMD_ROTL(x, n) (((x) << (n)) | ((x) >> (32 - (n))))
  #define RMD_ADD2(a, b) (a + b)
  #define RMD_ADD3(a, b, c) (a + b + c)
  #define RMD_ADD4(a, b, c, d) (a + b + c + d)
#endif
```

–ó–∞–ø—É—Å—Ç–∏–ª, –ø—Ä–æ–≤–µ—Ä–∏–ª ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ä–∞–∑–≤–µ —á—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–µ–º–Ω–æ–≥–æ –≤–æ–∑—Ä–æ—Å–ª–∞ –∏–∑-–∑–∞ –Ω–æ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Ä–∞—É–Ω–¥–æ–≤. –¢–æ—á–Ω–æ —Ç–∞–∫–∏–º –∂–µ –æ–±—Ä–∞–∑–æ–º –Ω–µ—Å–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è AVX512 (16 lanes), –Ω–æ —É –º–µ–Ω—è –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –ø–æ—ç—Ç–æ–º—É —è —ç—Ç–æ–≥–æ –Ω–µ —Å–¥–µ–ª–∞–ª. –î–∞ –∏ –±–µ–∑ —ç—Ç–æ–≥–æ —Å—Ç–∞—Ç—å—è —É–∂–µ –ø–æ–ª—É—á–∏–ª–∞—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–π.

## –í—ã–≤–æ–¥—ã

SIMD-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫–∞–∑–∞–ª–æ—Å—å –ø—Ä–æ—â–µ, —á–µ–º —è –æ–∂–∏–¥–∞–ª. –ù—É–∂–Ω—ã–µ intrinsics –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ —Å –ø–æ–º–æ—â—å—é GPT, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∑–∞–¥–∞—á—É. –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏—Ö –∏—Å–∫–∞—Ç—å —Å–ª–æ–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π. –ê–ª–≥–æ—Ä–∏—Ç–º RMD160 –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–µ (–ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ, —è –Ω–µ –∑–Ω–∞—é –¥—Ä—É–≥–∏—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è), –ø–æ—ç—Ç–æ–º—É –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –≤–Ω–µ –æ–±—É—á–∞—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω–æ–π.

SIMD-–≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∞—é—Ç –æ—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–æ, –∫–æ–Ω–µ—á–Ω–æ, –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∑–∞–¥–∞—á–∏: –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –ù–µ—Ç —Å–º—ã—Å–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SIMD, –µ—Å–ª–∏ –æ–¥–∏–Ω –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä 1, –∞ –¥—Ä—É–≥–æ–π ‚Äî 100 (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤). –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–ø–æ—Å–æ–±–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –±–∞—Ç—á–∞–º–∏.

–§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º –Ω–∞ [Github](https://github.com/vladkens/ecloop/blob/main/lib/rmd160s.c).
